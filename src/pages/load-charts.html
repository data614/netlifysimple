<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Load Australian Stock Charts</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stock-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin: 20px 0; }
        .stock-card { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .stock-header { display: flex; align-items: center; margin-bottom: 15px; }
        .stock-icon { font-size: 24px; margin-right: 10px; }
        .load-button { background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 4px; cursor: pointer; width: 100%; margin: 10px 0; font-size: 16px; }
        .load-button:hover { background: #0056b3; }
        .load-button:disabled { background: #ccc; cursor: not-allowed; }
        .chart-container { width: 100%; height: 300px; border: 1px solid #ddd; margin: 15px 0; background: #f8f9fa; position: relative; }
        .chart-placeholder { display: flex; align-items: center; justify-content: center; height: 100%; color: #666; }
        .chart-loaded { background: #e8f4fd; }
        .price-info { background: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace; }
        .status { padding: 5px 10px; border-radius: 4px; margin: 5px 0; font-size: 14px; }
        .loading { background: #fff3cd; color: #856404; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .trading-desk-link { display: inline-block; background: #28a745; color: white; padding: 15px 30px; text-decoration: none; border-radius: 4px; margin: 10px 10px 10px 0; font-weight: bold; }
        .trading-desk-link:hover { background: #1e7e34; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìà Load Australian Stock Charts</h1>
            <p>Click the buttons below to load live charts for QAN (Qantas), WOW (Woolworths), and WBC (Westpac).</p>
            
            <a href="https://tradingrestore1.netlify.app" target="_blank" class="trading-desk-link">üöÄ Open Main Trading Desk</a>
            <a href="https://tradingrestore1.netlify.app/complete-australian-test.html" target="_blank" class="trading-desk-link">üß™ View Complete Tests</a>
        </div>

        <div class="stock-grid">
            <!-- QAN Card -->
            <div class="stock-card">
                <div class="stock-header">
                    <div class="stock-icon">üõ©Ô∏è</div>
                    <div>
                        <h3 style="margin: 0;">QAN - Qantas Airways</h3>
                        <p style="margin: 0; color: #666;">XASX: QAN</p>
                    </div>
                </div>
                
                <button onclick="loadChart('QAN')" class="load-button" id="qan-button">üìà Load QAN Chart</button>
                <div class="status" id="qan-status" style="display: none;"></div>
                <div class="chart-container" id="qan-chart">
                    <div class="chart-placeholder">Click "Load QAN Chart" to display live data</div>
                </div>
                <div class="price-info" id="qan-info" style="display: none;"></div>
            </div>

            <!-- WOW Card -->
            <div class="stock-card">
                <div class="stock-header">
                    <div class="stock-icon">üõí</div>
                    <div>
                        <h3 style="margin: 0;">WOW - Woolworths</h3>
                        <p style="margin: 0; color: #666;">XASX: WOW</p>
                    </div>
                </div>
                
                <button onclick="loadChart('WOW')" class="load-button" id="wow-button">üìà Load WOW Chart</button>
                <div class="status" id="wow-status" style="display: none;"></div>
                <div class="chart-container" id="wow-chart">
                    <div class="chart-placeholder">Click "Load WOW Chart" to display live data</div>
                </div>
                <div class="price-info" id="wow-info" style="display: none;"></div>
            </div>

            <!-- WBC Card -->
            <div class="stock-card">
                <div class="stock-header">
                    <div class="stock-icon">üè¶</div>
                    <div>
                        <h3 style="margin: 0;">WBC - Westpac Banking</h3>
                        <p style="margin: 0; color: #666;">XASX: WBC</p>
                    </div>
                </div>
                
                <button onclick="loadChart('WBC')" class="load-button" id="wbc-button">üìà Load WBC Chart</button>
                <div class="status" id="wbc-status" style="display: none;"></div>
                <div class="chart-container" id="wbc-chart">
                    <div class="chart-placeholder">Click "Load WBC Chart" to display live data</div>
                </div>
                <div class="price-info" id="wbc-info" style="display: none;"></div>
            </div>
        </div>

        <div style="background: white; padding: 20px; border-radius: 8px; margin-top: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h2>üìä Chart Loading Instructions</h2>
            <ol>
                <li><strong>Click any "Load Chart" button above</strong> to fetch live data from Tiingo API</li>
                <li><strong>View real-time price data</strong> and current market information</li>
                <li><strong>See historical chart data</strong> with 30-day price movements</li>
                <li><strong>Open Trading Desk</strong> for full interactive charting experience</li>
            </ol>
            
            <h3>üîó Quick Links:</h3>
            <p>
                <a href="https://tradingrestore1.netlify.app" target="_blank" style="color: #007bff;">Main Trading Desk</a> - 
                <a href="https://tradingrestore1.netlify.app/complete-australian-test.html" target="_blank" style="color: #007bff;">Complete Test Suite</a> - 
                <a href="https://tradingrestore1.netlify.app/test-australian-stocks.html" target="_blank" style="color: #007bff;">API Tests</a>
            </p>
        </div>
    </div>

    <script>
        async function loadChart(symbol) {
            const button = document.getElementById(`${symbol.toLowerCase()}-button`);
            const status = document.getElementById(`${symbol.toLowerCase()}-status`);
            const chart = document.getElementById(`${symbol.toLowerCase()}-chart`);
            const info = document.getElementById(`${symbol.toLowerCase()}-info`);
            
            // Show loading state
            button.disabled = true;
            button.textContent = `üîÑ Loading ${symbol}...`;
            status.style.display = 'block';
            status.className = 'status loading';
            status.textContent = 'Fetching live data from Tiingo API...';
            
            try {
                // Get current price data
                const priceResponse = await fetch(`/api/tiingo?symbol=${symbol}&kind=price`);
                const priceData = await priceResponse.json();
                
                // Get historical data for chart
                const histResponse = await fetch(`/api/tiingo?symbol=${symbol}&kind=history&days=30`);
                const histData = await histResponse.json();
                
                // Get company info
                const metaResponse = await fetch(`/api/tiingo?symbol=${symbol}&kind=meta`);
                const metaData = await metaResponse.json();
                
                if (priceResponse.ok && histResponse.ok) {
                    // Update status
                    status.className = 'status success';
                    status.textContent = `‚úÖ ${symbol} data loaded successfully!`;
                    
                    // Update chart container
                    chart.className = 'chart-container chart-loaded';
                    
                    // Create simple chart visualization
                    const prices = histData.data ? histData.data.map(d => d.close) : [];
                    const dates = histData.data ? histData.data.map(d => d.date) : [];
                    const currentPrice = priceData.data ? (Array.isArray(priceData.data) ? priceData.data[0] : priceData.data) : null;
                    
                    chart.innerHTML = `
                        <div style="padding: 20px;">
                            <h4 style="margin: 0 0 10px 0; color: #007bff;">${symbol} - 30 Day Chart</h4>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                                <div><strong>Current Price:</strong> $${currentPrice?.close || currentPrice?.last || 'N/A'} AUD</div>
                                <div><strong>Data Points:</strong> ${prices.length}</div>
                            </div>
                            <div style="height: 180px; background: white; border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; border-radius: 4px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 20px;">üìà</div>
                                    <div><strong>${symbol} Chart Loaded</strong></div>
                                    <div style="color: #666; font-size: 12px;">
                                        ${prices.length > 0 ? `Price range: $${Math.min(...prices).toFixed(2)} - $${Math.max(...prices).toFixed(2)}` : 'Historical data available'}
                                    </div>
                                </div>
                            </div>
                            <div style="margin-top: 10px; font-size: 12px; color: #666;">
                                üí° Open the main Trading Desk for interactive charts with zoom, indicators, and real-time updates
                            </div>
                        </div>
                    `;
                    
                    // Show price info
                    if (currentPrice) {
                        info.style.display = 'block';
                        info.innerHTML = `
                            <strong>${symbol} Live Data:</strong><br>
                            Price: $${currentPrice.close || currentPrice.last || 'N/A'} AUD<br>
                            Date: ${currentPrice.date || 'N/A'}<br>
                            ${currentPrice.volume ? `Volume: ${currentPrice.volume.toLocaleString()}` : ''}
                            ${metaData.data ? `<br>Company: ${metaData.data.description || 'N/A'}` : ''}
                        `;
                    }
                    
                    // Update button
                    button.textContent = `‚úÖ ${symbol} Chart Loaded`;
                    button.style.background = '#28a745';
                    
                } else {
                    throw new Error(`Failed to load data: ${priceResponse.status} / ${histResponse.status}`);
                }
                
            } catch (error) {
                console.error(`Error loading ${symbol}:`, error);
                
                status.className = 'status error';
                status.textContent = `‚ùå Failed to load ${symbol}: ${error.message}`;
                
                chart.innerHTML = `
                    <div class="chart-placeholder" style="color: #dc3545;">
                        ‚ùå Chart loading failed<br>
                        <small>${error.message}</small>
                    </div>
                `;
                
                button.textContent = `‚ùå ${symbol} Failed`;
                button.style.background = '#dc3545';
            } finally {
                button.disabled = false;
            }
        }

        // Auto-load QAN as demonstration
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('qan-status').style.display = 'block';
                document.getElementById('qan-status').className = 'status loading';
                document.getElementById('qan-status').textContent = 'üí° Ready to load charts! Click any button above to start.';
            }, 1000);
        });
    </script>
</body>
</html>